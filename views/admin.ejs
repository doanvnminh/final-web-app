<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Qu·∫£n Tr·ªã - Admin</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        /* CSS ri√™ng cho trang Admin */
        .admin-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 15px;
        }

        .stat-box {
            background: #f4f4f4;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #2ecc71;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #333;
            color: white;
        }

        .btn-update {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }

        .btn-delete {
            background-color: #e74c3c;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
        }

        .edit-input {
            width: 100%;
            padding: 5px;
            box-sizing: border-box;
        }

        h2 {
            border-bottom: 2px solid #333;
            padding-bottom: 10px;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .table-responsive {
            overflow-x: auto;
        }
    </style>
</head>

<body>

    <div class="admin-container">
        <h1>Dashboard Qu·∫£n Tr·ªã</h1>
        <p>Xin ch√†o, <strong>Admin</strong>! | <a href="/">V·ªÅ trang ch·ªß</a></p>

        <div class="stat-box">
            <h3>T·ªïng l∆∞·ª£t truy c·∫≠p Website: <span style="color: red; font-size: 24px;">
                    <%= globalViews %>
                </span> l∆∞·ª£t</h3>
        </div>

        <h2>Qu·∫£n l√Ω tin ƒëƒÉng (Nh√† cho thu√™)</h2>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>T√™n nh√†</th>
                        <th width="15%">Gi√° (S·ª≠a ƒë∆∞·ª£c)</th>
                        <th width="30%">M√¥ t·∫£ (S·ª≠a ƒë∆∞·ª£c)</th>
                        <th>L∆∞·ª£t xem</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    <% houses.forEach(house=> { %>
                        <tr>
                            <form action="/admin/update-house" method="POST">
                                <input type="hidden" name="id" value="<%= house._id %>">
                                <td><a href="/house/<%= house._id %>">
                                        <%= house.title %>
                                    </a></td>
                                <td><input type="text" name="price" class="edit-input" value="<%= house.price %>"></td>
                                <td><textarea name="desc" class="edit-input" rows="2"><%= house.desc %></textarea></td>
                                <td>
                                    <%= house.views %>
                                </td>
                                <td><button type="submit" class="btn-update">C·∫≠p nh·∫≠t</button></td>
                            </form>
                        </tr>
                        <% }) %>
                </tbody>
            </table>
        </div>

        <h2>Qu·∫£n l√Ω b√¨nh lu·∫≠n</h2>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>B√†i vi·∫øt</th>
                        <th>Ng∆∞·ªùi g·ª≠i</th>
                        <th>N·ªôi dung</th>
                        <th>ƒêi·ªÉm</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    <% if(comments.length===0) { %>
                        <tr>
                            <td colspan="5" style="text-align: center;">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.</td>
                        </tr>
                        <% } %>

                            <% comments.forEach(comment=> { %>
                                <tr>
                                    <td>
                                        <%= comment.houseId ? comment.houseId.title : 'B√†i vi·∫øt ƒë√£ b·ªã x√≥a' %>
                                    </td>
                                    <td>
                                        <strong>
                                            <%= comment.name %>
                                        </strong><br>
                                        <small>
                                            <%= comment.email %>
                                        </small>
                                    </td>
                                    <td>
                                        <%= comment.content %>
                                    </td>
                                    <td>
                                        <%= comment.rating %>/5 sao
                                    </td>
                                    <td>
                                        <form action="/admin/delete-comment" method="POST"
                                            onsubmit="return confirm('B·∫°n ch·∫Øc ch·∫Øn mu·ªën x√≥a?');">
                                            <input type="hidden" name="commentId" value="<%= comment._id %>">
                                            <button type="submit" class="btn-delete">X√≥a</button>
                                        </form>
                                    </td>
                                </tr>
                                <% }) %>
                </tbody>
            </table>
        </div>

        <h2>üì¨ Tin nh·∫Øn t·ª´ kh√°ch h√†ng</h2>
        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>Ng√†y g·ª≠i</th>
                        <th>Ng∆∞·ªùi g·ª≠i</th>
                        <th>Email</th>
                        <th width="40%">N·ªôi dung</th>
                    </tr>
                </thead>
                <tbody>
                    <% if(!contacts || contacts.length===0) { %>
                        <tr>
                            <td colspan="4" style="text-align: center;">Ch∆∞a c√≥ tin nh·∫Øn n√†o.</td>
                        </tr>
                        <% } else { %>
                            <% contacts.forEach(msg=> { %>
                                <tr>
                                    <td>
                                        <%= msg.date ? msg.date.toLocaleDateString('vi-VN') : 'M·ªõi' %>
                                    </td>
                                    <td><strong>
                                            <%= msg.name %>
                                        </strong></td>
                                    <td>
                                        <%= msg.email %>
                                    </td>
                                    <td>
                                        <%= msg.message %>
                                    </td>
                                </tr>
                                <% }) %>
                                    <% } %>
                </tbody>
            </table>
        </div>

    </div>

    <div style="height: 50px;"></div>
</body>

</html>